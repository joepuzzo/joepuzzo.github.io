<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>Shell Program</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
    <style>
      body {
        min-width: 200px;
        max-width: 790px;
        margin: 0 auto;
        padding: 30px;
      }
    </style>
  </head>
  <body>
    <article class="markdown-body"><h2 id="shell-program"><a class="header-link" href="#shell-program"></a>Shell Program</h2>
<p><code>$ ls</code></p>
<pre class="hljs"><code><span class="hljs-label">Output:</span> 
    file1 
    file2</code></pre><h2 id="a-basic-shell"><a class="header-link" href="#a-basic-shell"></a>A basic shell</h2>
<pre class="hljs"><code><span class="hljs-keyword">for</span>(;;) { 
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"$"</span>); 
    fgets( line, <span class="hljs-number">1024</span>, stdin ); 
    parse( line ); 
    i = fork(); 
    <span class="hljs-keyword">if</span>( i == <span class="hljs-number">0</span> ) {  <span class="hljs-comment">//child </span>
        execl(line, ... ) <span class="hljs-comment">//remember we will overwrite child here</span>
    }
    wait(&amp;status); <span class="hljs-comment">//Shell parent</span>
}</code></pre><h2 id="how-many-prints"><a class="header-link" href="#how-many-prints"></a>How many prints</h2>
<pre class="hljs"><code>main() { 
    <span class="hljs-keyword">int</span> num; 
    fork();
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"start%d\n"</span>, getpid()); 
    num = fork(); 
    <span class="hljs-keyword">if</span>( num == <span class="hljs-number">0</span> ) { 
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"pid=%d\n"</span>, getpid())
    } 
}</code></pre><pre class="hljs"><code>output: 
    <span class="hljs-literal">start</span> <span class="hljs-number">100</span>
    <span class="hljs-literal">start</span> <span class="hljs-number">105</span> 
    <span class="hljs-number">108</span> 
    <span class="hljs-number">112</span></code></pre><pre class="hljs"><code><span class="hljs-keyword">for</span>( i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">4</span>; i++ ) { 
    cid = fork(); 
    <span class="hljs-keyword">if</span>( cid &gt; <span class="hljs-number">0</span> ) <span class="hljs-keyword">break</span>; <span class="hljs-comment">//break out of current "node"</span>
}
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"i=%d"</span>, i )</code></pre><pre class="hljs"><code>output: 
    <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> node <span class="hljs-number">1</span>
    <span class="hljs-number">2</span> <span class="hljs-keyword">from</span> node <span class="hljs-number">2</span>
    <span class="hljs-number">3</span> <span class="hljs-keyword">from</span> node <span class="hljs-number">3</span> 
    <span class="hljs-number">4</span> <span class="hljs-keyword">from</span> node <span class="hljs-number">4</span></code></pre><pre class="hljs"><code><span class="hljs-keyword">for</span>( i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">4</span>; i++ ) { 
    cid = fork(); 
    <span class="hljs-keyword">if</span>( cid == <span class="hljs-number">0</span> ) <span class="hljs-keyword">break</span>; <span class="hljs-comment">//break out of child</span>
}
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"i=%d"</span>, i )</code></pre><pre class="hljs"><code>output: 
    <span class="hljs-number">1</span> from <span class="hljs-keyword">node</span> <span class="hljs-number">2</span>
    <span class="hljs-number">2</span> from <span class="hljs-keyword">node</span> <span class="hljs-number">3</span>
    <span class="hljs-number">3</span> from <span class="hljs-keyword">node</span> <span class="hljs-number">4</span> 
    <span class="hljs-number">4</span> from <span class="hljs-keyword">node</span> <span class="hljs-number">1</span> ( <span class="hljs-literal">root</span>/parent )</code></pre><h2 id="os-process-tree"><a class="header-link" href="#os-process-tree"></a>OS Process Tree</h2>
<pre class="hljs"><code>    Bootstrap Code
         <span class="hljs-string">|</span>
    initialization
         <span class="hljs-string">| </span>
    init process pid = <span class="hljs-number">1</span>
         <span class="hljs-string">|</span>
    /    <span class="hljs-string">|    \</span>
   FS   login  MM
         <span class="hljs-string">|</span>
       shell
         <span class="hljs-string">|</span>
        a.out bitch </code></pre><h2 id="process-termination"><a class="header-link" href="#process-termination"></a>Process Termination</h2>
<ul class="list">
<li>Normal exit or abnormal exit <ol class="list">
<li>ilegal command ( trap )</li>
<li>you get <code>killed</code></li>
</ol>
</li>
<li>OS programs cleanup <ul class="list">
<li>Closes all open files</li>
<li>releases all memory held by process</li>
<li>removes process from all data structures</li>
</ul>
</li>
<li>OS assumes that parent wants to know exit status <ol class="list">
<li>Parent has called wait()<ul class="list">
<li>OS wakes parent and passes exit status of child </li>
</ul>
</li>
<li>Parent is aware but has not called wait (forked and has not called wait yet)<ul class="list">
<li>child becomes a <strong>zombie</strong> </li>
<li>OS erases entry space, closes files, and removes all resources held by the process</li>
<li>OS retains process table entry for child to keep the exit status</li>
</ul>
</li>
<li>parent is dead <code>:(</code> <ul class="list">
<li>If parent dies grandparent takes over </li>
<li>Child is orphan <code>:(</code></li>
</ul>
</li>
</ol>
</li>
</ul>
    </article>
  </body>
</html>
